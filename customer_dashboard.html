<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Headers - 8</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="Check_product/styles/reset.min.css" />
    <link rel="stylesheet" href="Check_product/styles/style.css" />
    <link rel="stylesheet" href="Check_product/styles/header-8.css" />

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBc7nYtXpPJjZsDSygPG50nNDgtMe2ECA0&callback=initMap"
    type="text/javascript"></script>

    <style type="text/css">
      form {
        
        padding-top: 250px;
        padding-right: 50px;
        padding-bottom: 50px;
        padding-left: 50px;
      } 
       body {
      background-image: url('images/customer2.jpg');
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-size: 100% 100%;
      
    }
    .modal {
      display: none;
      position: fixed; 
      z-index: 1; /* Sit on top */
      padding-top: 100px; /* Location of the box */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: white; 
      background-color: rgb(0,0,0);
      background-color: rgba(0,0,0,0.4);
    }

    /* Modal Content */
    .modal-content {
      border-radius: 25px;
      border: 2px solid #73AD21;
      background-color: #fefefe;
      margin: auto;
      padding: 30px;
      border: 1px solid #888;
      width: 35%;
      
    }

    /* The Close Button */
    .close {
      color: #aaaaaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }
    #content{
        display:none;
    }

    .map{
      display: none;
      position: absolute;
      z-index: 1;
      padding: 5px;
      margin-left: 34%;
      margin-top: 10%;
      left: -20;
      width: 30%;
      height: 52%;
      overflow: auto;
      background-color: rgb(106, 94, 94);
      border-radius:5px;
    }

    .map_content{
      /* display: block; */
      position: relative;
      border-radius: 7px;
      /* border: 2px solid #73AD21; */
      background-color: #fefefe;
      margin-top: 30px;
      
      border: 1px solid #888;
      width: 90%;
      height: 85%;

    }
    #x{
      float: right;
      background-color: red;
    }
    .modal-title{
      text-size-adjust: initial;
    }
    /* bold 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; */
    .spann{
      font-style: italic;
    }
    </style>

    <!-- Web3 scripts -->
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js" integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk=" crossorigin="anonymous"></script>
    <!-- <script src="https://www.unpkg.com/browse/web3@1.3.5/dist/web3.min.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-database.js"></script>


<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-analytics.js"></script>

  </head>
  <body>
    <!-- Header Start -->
    <header class="site-header">
      <div class="wrapper site-header__wrapper">
        <div class="site-header__start">
          <a href="#" class="brand">Brand</a>
        </div>
        <div class="site-header__middle">
          <nav class="nav">
            <button class="nav__toggle" aria-expanded="false" type="button">
              menu
            </button>
            <ul class="nav__wrapper">
              <li class="nav__item"><a href="index.html">Home</a></li>
              <li class="nav__item"><a href="profile.html">My Profile</a></li>
            </ul>
          </nav>
        </div>
        <div class="site-header__end">
          <button id="logout">Logout</button>
        </div>
      </div>
    </header>
    <!-- Header End -->
<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
    <center><p class="modal-title">Product Details</p></center>
    <br>
    <span>Product Name: </span><span class="spann" id="p_name"></span><br><br>
    <span>Product Type: </span><span class="spann"id="p_type"></span><br><br>
    <span>Model No: </span><span class="spann" id="p_model"></span>
    <br><br><br>
    <center><h2><strong>Manufacturer Details</strong></h2></center>
    <br>
    <span>Manufacturer Name: </span><span class="spann" id="m_name">Rohan Dasri</span><br><br>
    <span>Manufacturing Date: </span><span class="spann" id="m_date"></span><br><br>
    <!-- <button id="bm_loc">click hear</button> -->
    <span>Manufacturer Location: </span><span class="spann" id="m_loc"></span><br>
    <br><br><br>
    <center><h2>Distributor Details</h2></center>
    <br>
    <span>Distributor Name: </span><span class="spann" id="d_name"></span><br><br>
    <span>Distributor Location: </span><span class="spann" id="d_loc"></span><br><br>
    <span>Reached At Distributor on: </span><span class="spann" id="d_date"></span>
    <br><br><br>
    <center><h2>Retailer Details</h2></center>
    <br>
    <span>Retailer Name: </span><span class="spann" id="r_name"></span><br><br>
    <span>Retailer Location: </span><span class="spann" id="r_loc"></span><br><br>
    <span>Retailer At Distributor on: </span><span class="spann" id="r_date"></span>

  </div>
</div>
<center>
  <div class='map' id='map'>
    <button id="x">x</button>
    <div class="map_content" id="map_content">
    </div>
  </div>


</center>
    
      <form align="center" action="#">
        <input type="text" name="product_id" id="product_id" placeholder="Enter Your Product ID....">
      </form>
    
    <div align="center" >
      OR
    </div>
    <br>
    <br>
    <div align="center">
        <input type="file" id="file" name="filename">
    </div>
    <br><br><br><br>
    <center>
      <button name="button" id="search_qr">Search</i></button>
    </center>
    <p><span id="content"></span></p>
    <script type="text/javascript">
      

      window.onload = function(){
        if(localStorage.length == 0){    
          window.location = "login.html";
        }
      }
     

      var firebaseConfig = {
    apiKey: "AIzaSyAV3SVokGcFr1e04vvjjbFU3cag8L1VqaA",
    authDomain: "loginform-7acae.firebaseapp.com",
    databaseURL: "https://loginform-7acae-default-rtdb.firebaseio.com",
    projectId: "loginform-7acae",
    storageBucket: "loginform-7acae.appspot.com",
    messagingSenderId: "244622916096",
    appId: "1:244622916096:web:de0135a2f8c130929936e5",
    measurementId: "G-HPL4VJ18PJ"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();


     // document.getElementById("display_profile").innerHTML = localStorage.getItem("Name");
      //localStorage.clear();
var logout = document.getElementById("logout");
      // Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("search_Id");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal 
// btn.onclick = function() {
//   modal.style.display = "block";
//    document.getElementById("id1").value = "Paragraph changed!";
//    document.getElementById("id2").innerHTML = "Mobile";
// }

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}

      
       logout.onclick = function(){
       
          firebase.auth().signOut().then(() => {
            //window.onbeforeunload = function() { return "Your work will be lost."; };
             localStorage.clear();
            window.location = "login.html";
              
                      // Sign-out successful.
            }).catch((error) => {
              // An error happened.
            });
       }

       async function CheckMetamaskConnection() {
            // Modern dapp browsers...
            if (window.ethereum) {
                window.web3 = new Web3(window.ethereum);
                try {
                    // Request account access if needed
                    await ethereum.enable();
                    // Acccounts now exposed
                    return true;
                } catch (error) {
                    // User denied account access...
                    return false;
                }
            }
            // Legacy dapp browsers...
            else if (window.web3) {
                window.web3 = new Web3(web3.currentProvider);
                // Acccounts always exposed
                return true;
            }
            // Non-dapp browsers...
            else {
                console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
                return false;
            }
        }

        $(document).ready(async function () {
            var IsMetamask = await CheckMetamaskConnection();
            if (IsMetamask) {
                var Address="0x8F88657384EDC5870699d397c7F361d862ee9E83";
                var ABI=[
	{
		"constant": true,
		"inputs": [
			{
				"name": "id",
				"type": "string"
			}
		],
		"name": "GetManufactDetails",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "id",
				"type": "string"
			},
			{
				"name": "loc",
				"type": "string"
			},
			{
				"name": "RName",
				"type": "string"
			},
			{
				"name": "date",
				"type": "string"
			}
		],
		"name": "RetailerUpdate",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "id",
				"type": "string"
			}
		],
		"name": "GetRetailerDetails",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "id",
				"type": "string"
			}
		],
		"name": "GetDistDetails",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "id",
				"type": "string"
			}
		],
		"name": "GetProductDetails",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "id",
				"type": "string"
			},
			{
				"name": "PName",
				"type": "string"
			},
			{
				"name": "Type",
				"type": "string"
			},
			{
				"name": "model_no",
				"type": "string"
			},
			{
				"name": "loc",
				"type": "string"
			},
			{
				"name": "MName",
				"type": "string"
			},
			{
				"name": "date",
				"type": "string"
			}
		],
		"name": "AddProduct",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "generateID",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "id",
				"type": "string"
			},
			{
				"name": "loc",
				"type": "string"
			},
			{
				"name": "DName",
				"type": "string"
			},
			{
				"name": "date",
				"type": "string"
			}
		],
		"name": "UpdateProduct",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	}
];
                myContract =new web3.eth.Contract(ABI,Address);//await web3.eth.contract(ABI).at(Address);
                console.log("Metamask detected!")
            } else {
                console.log("Metamask not detected");
            }
           
        });

      document.getElementById("search_qr").onclick=function(){
        modal.style.display = "block";
        // document.getElementById("id1").value = "Paragraph changed!";
        // document.getElementById("id2").innerHTML = "Mobile";
        var id=document.getElementById("product_id").value.toString();
        if(id=="")
        {
          id=document.getElementById("content").innerHTML.toString();
            console.log("QR id:",id);
        }
        console.log("QR id:",id);
            myContract.methods.GetProductDetails(id).call().then(function(result){
              console.log(result);
              var product_details=result.split("@");
              document.getElementById("p_name").innerHTML=product_details[0];
              document.getElementById("p_type").innerHTML=product_details[1];
              document.getElementById("p_model").innerHTML=product_details[2];
            });
            myContract.methods.GetManufactDetails(id).call().then(function(result){
              console.log(result);
              var Manufaturer_details=result.split("@");
              localStorage.setItem("Man_loc",Manufaturer_details[1]);
              document.getElementById("m_name").innerHTML=Manufaturer_details[0];
              document.getElementById("m_loc").innerHTML=Manufaturer_details[1];
              document.getElementById("m_date").innerHTML=Manufaturer_details[2];
              getAddr(Manufaturer_details[1]);
            });
            myContract.methods.GetDistDetails(id).call().then(function(result){
              console.log(result);
              var Distributor_details=result.split("@");
              localStorage.setItem("Dist_loc",Distributor_details[1]);
              document.getElementById("d_name").innerHTML=Distributor_details[0];
              document.getElementById("d_loc").innerHTML=Distributor_details[1];
              document.getElementById("d_date").innerHTML=Distributor_details[2];
            });
            myContract.methods.GetRetailerDetails(id).call().then(function(result){
              console.log(result);
              var Retailor_details=result.split("@");
              localStorage.setItem("Ret_loc",Retailor_details[1]);
              document.getElementById("r_name").innerHTML=Retailor_details[0];
              document.getElementById("r_loc").innerHTML=Retailor_details[1];
              document.getElementById("r_date").innerHTML=Retailor_details[2];
            });
        
      }

      function failure(){
        console.log("Failure occured");
      }
      
      // document.getElementById("bm_loc").addEventListener("click", function() {
      //   (document.getElementById("map")).style.display="block";
      //   var lonlat=localStorage.getItem("Man_loc").split(" ");
      //   var coordinates=new google.maps.LatLng(lonlat[0],lonlat[1]);
      //   var mapOptions={
      //     zoom:9,
      //     center:coordinates,
      //     mapTypeID: 'roadmap'//google.maps.MapTypeID.ROADMAP
      //   }
      //   var map=new google.maps.Map(document.getElementById("map_content"),mapOptions);
      //   var maker=new google.maps.Marker({position:coordinates,map:map});
      //   // var latlon =lonlat[0]+ "," +lonlat[1];
      //   // var img_url = "https://maps.googleapis.com/maps/api/staticmap?center="+latlon+"&zoom=14&size=400x300&sensor=false&key=AIzaSyBc7nYtXpPJjZsDSygPG50nNDgtMe2ECA0";
      //   // //var img_url="https://maps.googleapis.com/maps/api/js?key=AIzaSyBc7nYtXpPJjZsDSygPG50nNDgtMe2ECA0&callback=initMap";
      //   // document.getElementById("map").innerHTML = "<img src='"+img_url+"'>";
      // });

      document.getElementById("x").addEventListener("click",function(){
        (document.getElementById("map")).style.display="none";
      });
    </script>
    <script type="text/javascript" src="js1/qrReader.js"></script>
    <script src="Check_product/js/header-8.js"></script>
    
  </body>
</html>